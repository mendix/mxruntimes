import{d as computed,o as observable,a as action}from"./f0d16cff.js";import"./ad1d08ab.js";import{z as valueMonitor}from"./79cc6120.js";import{a as asProperty}from"./72a4665b.js";import{Big}from"big.js";import{x as assertIsNonEnumValue}from"./6ae611dc.js";import"./b98156b5.js";import{t as translate}from"./e50ef415.js";import"./0e7164f2.js";import"./09e8fbb9.js";import{a as createNonEnumFormatter}from"./b2cd71f1.js";const WidgetVariableProperty=asProperty(({slot:slot,type:type,initialValue:initialValue,widgetId:widgetId},store)=>{void 0===store.get$(widgetId,slot)&&void 0!==initialValue&&store.set(widgetId,slot,"number"==typeof initialValue?Big(initialValue):initialValue);const defaultFormatter=createNonEnumFormatter(type,{}),submittedValue=computed(()=>store.get$(widgetId,slot)),unsubmittedValue=observable.box(void 0,{deep:!1}),formatter=observable.box(defaultFormatter,{deep:!1});let validator;const submittedValueMonitor=valueMonitor(()=>submittedValue.get());return()=>{submittedValueMonitor.runIfChanged(()=>unsubmittedValue.set(void 0));const submitted=submittedValue.get(),unsubmitted=unsubmittedValue.get(),value=void 0!==unsubmitted&&"unparsed"===unsubmitted.state?void 0:void 0!==unsubmitted?unsubmitted.value:submitted,displayValue=void 0!==unsubmitted&&"unparsed"===unsubmitted.state?unsubmitted.value:formatter.get().format(void 0!==unsubmitted?unsubmitted.value:submitted);return{status:"available",validation:void 0!==unsubmitted?unsubmitted.message:void 0,universe:void 0,readOnly:!1,formatter:formatter.get(),value:value,displayValue:displayValue,setValidator:v=>validator=v,setFormatter:action(f=>formatter.set(f||defaultFormatter)),setTextValue:action(v=>(function(value){const parseResult=formatter.get().parse(value);parseResult.valid?setValue(parseResult.value):unsubmittedValue.set({state:"unparsed",value:value,message:getInvalidMessage(type)})})(v)),setValue:action(v=>setValue(v))}};function setValue(value){assertIsNonEnumValue(value,type);const validation=void 0!==validator?validator(value):void 0;void 0!==validation?unsubmittedValue.set({state:"parsed",value:value,message:validation}):store.set(widgetId,slot,value)}});function getInvalidMessage(attributeType){switch(attributeType){case"String":case"Boolean":case"ObjectReferenceSet":return translate("mendix.lib.Validations","invalid_value");case"Decimal":return translate("mendix.lib.Validations","invalid_number")}}export{WidgetVariableProperty};
