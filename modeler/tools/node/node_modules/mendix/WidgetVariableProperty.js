import{e as computed,o as observable,a as action}from"./39c2a2fb.js";import"./546dec4f.js";import{a as asProperty}from"./d63ed225.js";import{B as Big}from"./2bc24ff8.js";import"./2209f9e8.js";import{t as translate}from"./dc9e34e0.js";import"./0c69f47a.js";import"./d2546a03.js";import"./fdd4c4ff.js";import{n as assertIsNonEnumValue}from"./37fca272.js";import"./38d79760.js";import"./6dbf3b84.js";import{v as valueMonitor}from"./b4041520.js";import{a as createNonEnumFormatter}from"./f6cd9545.js";const WidgetVariableProperty=asProperty(({slot:slot,type:type,initialValue:initialValue,widgetId:widgetId},store)=>{void 0===store.get(widgetId,slot)&&void 0!==initialValue&&store.set(widgetId,slot,"number"==typeof initialValue?Big(initialValue):initialValue);const formatter=createNonEnumFormatter(type,{}),submittedValue=computed(()=>store.get(widgetId,slot)),unsubmittedValue=observable.box(void 0,{deep:!1}),formatterConfig=observable.box(formatter.defaultConfig,{deep:!1});let validator;const submittedValueMonitor=valueMonitor(()=>submittedValue.get());return()=>{submittedValueMonitor.runIfChanged(()=>unsubmittedValue.set(void 0));const submitted=submittedValue.get(),unsubmitted=unsubmittedValue.get(),value=void 0!==unsubmitted&&"unparsed"===unsubmitted.state?void 0:void 0!==unsubmitted?unsubmitted.value:submitted,displayValue=void 0!==unsubmitted&&"unparsed"===unsubmitted.state?unsubmitted.value:formatter.format(void 0!==unsubmitted?unsubmitted.value:submitted,formatterConfig.get());return{status:"available",validation:void 0!==unsubmitted?unsubmitted.message:void 0,universe:void 0,readOnly:!1,formatter:formatter,value:value,displayValue:displayValue,setValidator:v=>validator=v,setFormatting:action(f=>formatterConfig.set(f)),setTextValue:action(v=>(function(value){const parseResult=formatter.parse(value,formatterConfig.get());parseResult.valid?setValue(parseResult.value):unsubmittedValue.set({state:"unparsed",value:value,message:getInvalidMessage(type)})})(v)),setValue:action(v=>setValue(v))}};function setValue(value){assertIsNonEnumValue(value,type);const validation=void 0!==validator?validator(value):void 0;void 0!==validation?unsubmittedValue.set({state:"parsed",value:value,message:validation}):store.set(widgetId,slot,value)}});function getInvalidMessage(attributeType){switch(attributeType){case"String":case"Boolean":case"ObjectReferenceSet":return translate("mendix.lib.Validations","invalid_value");case"Decimal":return translate("mendix.lib.Validations","invalid_number")}}export{WidgetVariableProperty};
