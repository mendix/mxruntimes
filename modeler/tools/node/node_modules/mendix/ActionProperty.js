import{f as observable$$1,h as computed$$1,b as glitchFree}from"./5dda5eb7.js";import{m as mapValues,d as ensure}from"./ddd19e5a.js";import{c as asProperty}from"./71d615f7.js";import"./3019ed1f.js";import"./967e2ac0.js";import{a as translate}from"./c38a792c.js";import"./d9069e30.js";import{a as ValidationError}from"./33defb9b.js";import"./d5eebceb.js";import"./eed44530.js";import"./aa3ddc5d.js";import{b as pageScope}from"./2a30f3af.js";import"./8175df0e.js";import"./3c905f8d.js";import"./b26e8ded.js";import"./a81bf7bc.js";import"./eaafd07f.js";import{h as getOrCrashL}from"./cf055752.js";import"./86e285ad.js";import"./22b17a9f.js";import{c as getActionParameters}from"./a057627c.js";import{a as executeAction}from"./ac622490.js";const ActionProperty=asProperty((config,store,widgetId)=>{const actionsInProgress=observable$$1.box(0),isExecuting=computed$$1(()=>actionsInProgress.get()>0);return()=>{const parameters=getActionParameters(config.action.argMap,store),canExecute=Object.values(parameters).every(p=>"available"===p.status);return{canExecute:canExecute,isExecuting:isExecuting.get(),execute:canExecute?glitchFree(()=>(function(parameters){if(Object.keys(parameters).some(arg=>{const parameter=parameters[arg];return"selection"===config.action.argMap[arg].source&&void 0!==parameter&&"objects"in parameter&&0===parameter.objects.length}))return void mx.ui.showMessage("info",translate("mxui.widget.DataGrid","no_selection"),!1);const isInvalid=store.get(widgetId,"isInvalid"),currentForm=ensure(store.get(pageScope,"form"))[0];actionsInProgress.set(actionsInProgress.get()+1),executeAction(config.action,{abortOnClientValidations:!0,abortOnServerValidations:config.abortOnServerValidation,widgetIsValid:!isInvalid,currentForm:currentForm},parameters,glitchFree(()=>{actionsInProgress.set(actionsInProgress.get()-1)}),glitchFree(e=>{actionsInProgress.set(actionsInProgress.get()-1),e instanceof ValidationError||mx.onError(e)}))})(mapValues(parameters,getOrCrashL))):()=>mx.logger.debug(`Widget is attempting to execute a ${config.action.type} action which is not executable.`)}}});export{ActionProperty};
