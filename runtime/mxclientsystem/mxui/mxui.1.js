/* @preserve
    Copyright (c) 2005-2016, Mendix bv. All rights reserved.
    See mxclientsystem/licenses.txt for third party licenses that apply.
*/
(window.mxJsonp=window.mxJsonp||[]).push([[1],{525:function(e,t){e.exports={LIKE_ESCAPE_CHAR:"~",QUOTE_CHAR:'"'}},526:function(e,t){function n(e){this.fork=e}n.of=function(e){return new n(function(t,n){n(e)})},n.prototype.chain=function(e){var t=this;return new n(function(n,r){t.fork(n,function(t){e(t).fork(n,r)})})},n.prototype.orElse=function(e){var t=this;return new n(function(n,r){t.fork(function(t){e(t).fork(n,r)},r)})},n.prototype.ap=function(e){var t,r,i,o=this,u=2;return new n(function(n,a){function c(){0==--u&&a(t(r))}function s(e){void 0===i&&n(i=e)}o.fork(s,function(e){t=e,c()}),e.fork(s,function(e){r=e,c()})})},n.prototype.map=function(e){return this.chain(function(t){return n.of(e(t))})},n.rejected=n.prototype.rejected=function(e){return new n(function(t,n){t(e)})},n.parallel=function(e){return new n(function(t,n){var r,i=e.length,o=new Array(e.length);0!==e.length?e.forEach(function(e,u){e.fork(function(e){void 0===r&&(r=e,t(e))},function(e){return function(t){o[e]=t,void 0===r&&0==--i&&n(o)}}(u))}):n(o)})},n.sequence=function(e){return e.reduce(function(e,t){return e.chain(function(e){return t})},n.of(null))},e.exports=n},527:function(e,t,n){var r=n(537),i=n(526),o=new r(i);o.rejected=function(e){return new o(function(t){return i.rejected(e)})},o.parallel=function(e){return new o(function(t){return new i(function(n,r){if(0!==e.length){var i=new Array(e.length),o=e.length,u=!1;e.forEach(function(e,a){e.run(t).fork(function(e){u||(u=!0,n(e))},function(e){i[a]=e,u||0!=--o||r(i)})})}else r([])})})},o.sequence=function(e){return e.reduce(function(e,t){return e.chain(function(e){return t.map(function(t){return e.concat([t])})})},o.of([]))},e.exports=o},528:function(e,t,n){var r=n(526),i={promiseFromTask:function(e){return new Promise(function(t,n){e.fork(n,t)})},callbackFromTask:function(e,t,n){e.fork(function(e){n&&n(e)},function(e){t&&t(e)})},taskFromPromise:function(e){return new r(function(t,n){e.then(n,t)})}};e.exports=i},532:function(e,t,n){var r=n(533),i=n(538),o=n(539),u=n(527),a=n(528);function c(){return window.openDatabase("MendixDatabase","1","Mendix Database",10485760)}function s(e,t){o.call(this),t=t||c,this._tableNames=e;var n=t();this._databasePromise=this._initialize(n)}s.prototype=Object.create(o.prototype),s.prototype._getDatabase=function(){return this._databasePromise},s.prototype._initialize=function(e){var t=r.createCreateTransaction(this._tableNames);return a.promiseFromTask(i.runWriteTransaction(e,t)).then(function(){return e})},s.prototype._fetch=function(e){return function(t){var n=r.createFetchByGuidTransaction(e);return a.promiseFromTask(i.runReadTransaction(t,n))}},s.prototype._fetchSlice=function(e,t,n){return function(o){var u=r.createFetchSliceTransaction(e,t,n.offset,n.limit,n.sort);return a.promiseFromTask(i.runReadTransaction(o,u))}},s.prototype._rebuildDb=function(e){return u.ask().chain(function(t){var n=r.createRebuildTransaction(this._tableNames,e);return new u(function(e){return i.runWriteTransaction(t,n)})}.bind(this))},s.prototype._insertOrReplace=function(e){return function(t){var n=r.createInsertOrReplaceTransaction(e);return a.promiseFromTask(i.runWriteTransaction(t,n))}},s.prototype._cleanDatabase=function(){var e=this;return function(t){var n=r.createCleanTransaction(e._tableNames);return a.promiseFromTask(i.runWriteTransaction(t,n))}},s.prototype._fetchDirty=function(){return u.ask().chain(function(e){var t=r.createFetchDirtyObjectsTransaction();return new u(function(n){return i.runWriteTransaction(e,t)})})},s.prototype._makeClean=function(e){return u.ask().chain(function(t){var n=r.createMakeCleanTransaction(e);return new u(function(e){return i.runWriteTransaction(t,n)})})},s.prototype._cleanupDirtyObjects=function(){return function(e){var t=r.createDirtyCleanupTransaction();return a.promiseFromTask(i.runWriteTransaction(e,t))}},e.exports=s},533:function(e,t,n){var r=n(525),i=n(534),o=i.SqlSelectBuilder,u=i.constraintBuilder,a=n(535),c=n(536),s=n(527),l=n(526),f=n(10),m="_guidToTable",p={String:"text",Integer:"text",Long:"text",Decimal:"text",Float:"text",Currency:"text",Enum:"text",HashString:"text",ObjectReference:"text",DateTime:"integer",Boolean:"integer",AutoNumber:"integer",Binary:"blob"},h={String:x,Integer:j,Long:j,Decimal:j,Float:j,Currency:j,Enum:x,HashString:x,ObjectReference:x,DateTime:function(e){return null!=e?Number(e):null},Boolean:Number,AutoNumber:x,Binary:x},d={String:x,Integer:x,Long:x,Decimal:x,Float:x,Currency:x,Enum:x,HashString:x,ObjectReference:x,DateTime:T,Boolean:Boolean,AutoNumber:x,Binary:x},y={String:T,Integer:T,Long:T,Decimal:T,Float:T,Currency:T,Enum:T,HashString:T,ObjectReference:T,DateTime:function(e){return e?Number(e):null},Boolean:function(e){return"false"!==e},AutoNumber:T,Binary:T},b={createCreateTransaction:g,createCleanTransaction:function(e){var t=[m].concat(e).map(k).map(function(e){return"DELETE FROM '"+e+"'"}).map(function(e){return S(e,[])});return s.parallel(t).map(function(e){})},createFetchByGuidTransaction:function(e){return S((new o).from(m).where(u.equals("guid")).select(),[e]).chain(function(t){if(0===t.rows.length)return s.of(null);if(1!==t.rows.length)return s.rejected(new Error("db consistency error"));var n=t.rows.item(0),r=n.tableName,i=Boolean(n.dirty),a=n.readonlyAttrs;return S((new o).from(k(r)).where(u.equals("guid")).select(),[e]).chain(function(e){return 0===e.rows.length?s.rejected(new Error("entity not found")):1!==e.rows.length?s.rejected(new Error("db consistency error")):s.of(R(window.mx.meta.getEntity(r),i,a,e.rows.item(0)))})})},createFetchSliceTransaction:function(e,t,n,i,a){t=t||[],a=a||[];var c=window.mx.meta.getEntity(e),l=function(e,t){var n=[];return{builder:(new o).where(t.map(function t(i){if(i.constraints)return u[i.operator](i.constraints.map(t).filter(function(e){return null!==e}));if(null==i.value)switch(i.operator){case"contains":return null;case"equals":return u.isNull(k(i.attribute),i.negate)}var o=e.getAttributeType(i.attribute);var a=y[o];var c=h[o];var s=c(a(i.value));n.push("contains"===i.operator?(l=s,f=r.LIKE_ESCAPE_CHAR,l.replace(new RegExp(f,"g"),f+f).replace(/%/g,f+"%").replace(/_/g,f+"_")):s);var l,f;return u[i.operator](k(i.attribute),i.negate)}).filter(function(e){return null!==e})),args:n}}(c,t),f=l.builder.from(k(e)),p=l.args,d=f.offset(n).limit(i).join(m,"guid",["dirty","readonlyAttrs"]),b=S((d=a.reduce(function(e,t){return e.order(t[0],t[1])},d)).select(),p).map(function(e){for(var t=[],n=0;n<e.rows.length;++n){var r=e.rows.item(n),i=Boolean(r[m+".dirty"]),o=D(r,"readonlyAttrs");t.push(R(c,i,o,r))}return t}),g=S(f.selectCount("cnt"),p).map(function(e){return e.rows.item(0).cnt});return s.parallel([b,g])},createInsertOrReplaceTransaction:function(e){return s.parallel(e.map(function(e){var t=e.$objectType,n=w(),r=_(t,e);return[S(n.insertOrReplace(),[e.guid,t,1,JSON.stringify(e.$readonlyAttrs)]),S(r.builder.insertOrReplace(),r.values)]}).reduce(function(e,t){return e.concat(t)},[])).map(function(e){})},createFetchDirtyObjectsTransaction:function(){return v().chain(function(e){var t=E(e.rows).map(function(e){var t=e.tableName,n=(new o).from(k(t)).join(m,"guid",["dirty","readonlyAttrs"]).where(u.equals(m+".dirty")).select(),r=window.mx.meta.getEntity(t);return S(n,[1]).map(function(e){return E(e.rows).map(function(e){return R(r,!0,D(e,"readonlyAttrs"),e)})})});return s.parallel(t)}).map(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})},createMakeCleanTransaction:function(e){var t=e.map(function(e){return S("UPDATE "+m+" set dirty = 0 where guid = ?",[e.guid])});return s.parallel(t).map(function(e){})},createDirtyCleanupTransaction:function(){return v().chain(function(e){var t=E(e.rows).map(function(e){var t=e.tableName;return S("DELETE FROM "+k(t)+" WHERE guid IN (\n                            SELECT guid FROM "+m+" WHERE tableName = ? AND dirty = 1)",[t])});return s.sequence([s.parallel(t),S("DELETE FROM "+m+" WHERE dirty = 1")]).map(function(e){})})},createRebuildTransaction:function(e,t){var n=function(e){var t=[m].concat(e).map(k).map(function(e){return"DROP TABLE IF EXISTS '"+e+"'"}).map(function(e){return S(e,[])});return s.sequence([s.parallel(t),g(e)])}(e),r=e.map(function(e){var n=t.filter(function(t){return t.$objectType===e});return function(e,t){var n=t.reduce(function(t,n){var r=w(),i=_(e,n);return t.concat([S(r.insert(),[n.guid,e,0,JSON.stringify(n.$readonlyAttrs)]),S(i.builder.insert(),i.values)])},[]);return s.parallel(n).map(function(e){})}(e,n)});return s.sequence([n,s.parallel(r)]).map(function(e){})}};function g(e){var t=[S((new a).table(m).primaryKeyColumn("guid","text").column("tableName","text").column("dirty","boolean").column("readonlyAttrs","text").createIfNotExists(),[])].concat(e.map(function(e){return S(function(e){var t=window.mx.meta.getEntity(e);return t.getAttributes().map(function(e){var n=t.getAttributeType(e);return{attr:e,type:p[n]}})}(e).reduce(function(e,t){return e.column(k(t.attr),t.type)},(new a).table(k(e)).primaryKeyColumn("guid","text")).createIfNotExists(),[])}));return s.parallel(t).map(function(e){})}function v(){return S((new o).from(m).where(u.equals("dirty")).selectDistinct("tableName"),[1])}function w(){return(new c).into(m).column("guid").column("tableName").column("dirty").column("readonlyAttrs")}function _(e,t){var n=window.mx.meta.getEntity(e),r=n.getAttributes().reduce(function(e,r){var i=n.getAttributeType(r),o=h[i];if(!o)return e;var u=o(t[r]);return{attrs:e.attrs.concat([r]),values:e.values.concat([u])}},{attrs:["guid"],values:[t.guid]});return{builder:r.attrs.reduce(function(e,t){return e.column(k(t))},(new c).into(k(e))),values:r.values}}function j(e){if(null==e)return null;var t=new f(e),n=20-Math.max(0,t.e)-1;return(t.s<0?"-":"")+new Array(n+1).join("0")+t.abs().toFixed()}function x(e){return null!=e?String(e):null}function T(e){return e}function E(e){for(var t=[],n=0;n<e.length;++n)t.push(e.item(n));return t}function k(e){return e.replace(".","$")}function O(e){return e.replace("$",".")}function R(e,t,n,r){var i,o={guid:r.guid,$objectType:e.getEntity(),$dirty:t,$readonlyAttrs:JSON.parse(n)};for(var u in r)if(!("guid"===(i=u)||i.indexOf(".")>-1)){var a=O(u),c=e.getAttributeType(a),s=d[c];s&&(o[a]=s(r[u]))}return o}function D(e,t){return e[m+"."+t]}function S(e,t){return t=t||[],new s(function(n){return new l(function(r,i){n.executeSql(e,t,function(e,t){return i(t)},function(e,t){return r(t)})})})}e.exports=b},534:function(e,t,n){"use strict";n.r(t),n.d(t,"SqlSelectBuilder",function(){return u}),n.d(t,"constraintBuilder",function(){return f});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(525),u=function(){function e(t,n){i(this,e),this._select=n&&n.select||t&&t._select||null,this._from=n&&n.from||t&&t._from||null,this._join=n&&n.join||t&&t._join||null,this._constraints=n&&n.constraints||t&&t._constraints||[],this._orderBy=n&&n.orderBy||t&&t._orderBy||[],this._limit=n&&n.limit||t&&t._limit||null,this._offset=n&&n.offset||t&&t._offset||null}return r(e,[{key:"from",value:function(t){return new e(this,{from:t})}},{key:"join",value:function(t,n,r){return new e(this,{join:{tableName:t,joinOnColumn:n,selectedColumns:r}})}},{key:"where",value:function(t){return new e(this,{constraints:this._constraints.concat(t)})}},{key:"order",value:function(t,n){return new e(this,{orderBy:this._orderBy.concat([[t,n]])})}},{key:"limit",value:function(t){return new e(this,{limit:t})}},{key:"offset",value:function(t){return new e(this,{offset:t})}},{key:"selectDistinct",value:function(e){return Array.isArray(e)&&(e=e.join(", ")),"SELECT DISTINCT "+e+" "+this._buildSql()}},{key:"selectCount",value:function(e){return"SELECT COUNT(*) AS "+e+this._buildSql()}},{key:"select",value:function(){var e=this,t="SELECT "+this._from+".*";return this._join&&this._join.selectedColumns.forEach(function(n){t+=", "+e._join.tableName+".["+n+'] as "'+e._join.tableName+"."+n+'"'}),t+this._buildSql()}},{key:"_buildSql",value:function(){var e=this,t=" FROM "+this._from+" AS "+this._from;return this._join&&(t+=" JOIN "+this._join.tableName+" AS "+this._join.tableName+" USING ("+this._join.joinOnColumn+")"),this._constraints.length>0&&(t+=" WHERE "+this._constraints.map(function(t){return t.build(e._from)}).join(" AND ")),this._orderBy.length>0&&(t+=" ORDER BY "+this._orderBy.map(function(t){return e._from+".["+t[0]+"] "+t[1]}).join(", ")),this._limit&&(t+=" LIMIT "+this._limit),this._offset&&(t+=" OFFSET "+this._offset),t}}]),e}(),a={equals:m("="),lessThan:m("<"),lessThanOrEquals:m("<="),greaterThan:m(">"),greaterThanOrEquals:m(">="),contains:function(e){var t="";return t+=e,t+=" LIKE '%' || ? || '%'",t+=" ESCAPE '"+o.LIKE_ESCAPE_CHAR+"'"}},c=function(){function e(t,n,r){i(this,e),this._column=t,this._operator=n,this._negate=!!r}return r(e,[{key:"build",value:function(e){var t=a[this._operator],n=this._column.indexOf(".")>-1?this._column:e+".["+this._column+"]";return(this._negate?"NOT ":"")+t(n)}}]),e}(),s=function(){function e(t,n){i(this,e),this._column=t,this._negate=!!n}return r(e,[{key:"build",value:function(e){return(this._column.indexOf(".")>-1?this._column:e+".["+this._column+"]")+" IS "+(this._negate?"NOT ":"")+"NULL"}}]),e}(),l=function(){function e(t,n){i(this,e),this.group=t,this.constraints=n||[]}return r(e,[{key:"add",value:function(e){this.constraints.push(e)}},{key:"build",value:function(e){return"("+this.constraints.map(function(t){return t.build(e)}).join(" "+this.group+" ")+")"}}]),e}(),f={and:function(e){return new l("and",e)},or:function(e){return new l("or",e)},equals:function(e,t){return new c(e,"equals",t)},isNull:function(e,t){return new s(e,t)},lessThan:function(e,t){return new c(e,"lessThan",t)},lessThanOrEquals:function(e,t){return new c(e,"lessThanOrEquals",t)},greaterThan:function(e,t){return new c(e,"greaterThan",t)},greaterThanOrEquals:function(e,t){return new c(e,"greaterThanOrEquals",t)},contains:function(e,t){return new c(e,"contains",t)}};function m(e){return function(t){return t+" "+e+" ?"}}},535:function(e,t,n){var r=n(525);function i(e,t){this._tableName=t&&t.tableName||e&&e._tableName||null,this._columns=t&&t.columns||e&&e._columns||[]}function o(e){var t=r.QUOTE_CHAR;return t+e+t}i.prototype.table=function(e){return new i(this,{tableName:e})},i.prototype.column=function(e,t){return new i(this,{columns:this._columns.concat({columnName:e,columnType:t,isPrimary:!1})})},i.prototype.primaryKeyColumn=function(e,t){return new i(this,{columns:this._columns.concat({columnName:e,columnType:t,isPrimary:!0})})},i.prototype.createIfNotExists=function(){var e="";return e+="CREATE TABLE IF NOT EXISTS "+o(this._tableName),e+=this._buildSql()},i.prototype._buildSql=function(){var e="";return this._columns.length>0&&(e+=" (",e+=this._columns.map(function(e){return[o(e.columnName),e.columnType,"text"===e.columnType?" COLLATE NOCASE ":"",e.isPrimary?"PRIMARY KEY ":""].join(" ").slice(0,-1)},this).join(", "),e+=")"),e},e.exports=i},536:function(e,t,n){var r=n(525);function i(e,t){if(!(this instanceof i))return new i;this._tableName=t&&t.tableName||e&&e._tableName||null,this._columnNames=t&&t.columnNames||e&&e._columnNames||[]}function o(e){var t=r.QUOTE_CHAR;return t+e+t}i.prototype.into=function(e){return new i(this,{tableName:e})},i.prototype.column=function(e){return new i(this,{columnNames:this._columnNames.concat(e)})},i.prototype.insert=function(){var e="";return e+="INSERT INTO "+o(this._tableName),e+=this._buildSql()},i.prototype.insertOrReplace=function(){var e="";return e+="INSERT OR REPLACE INTO "+o(this._tableName),e+=this._buildSql()},i.prototype._buildSql=function(){var e="";return this._columnNames.length>0&&(e+=" (",e+=this._columnNames.map(o).join(", "),e+=")"),e+=" VALUES (",e+="?"+new Array(this._columnNames.length).join(", ?"),e+=")"},e.exports=i},537:function(e,t){e.exports=function(e){function t(e){this.run=e}return t.prototype.chain=function(e){return new t(function(t){return this.run(t).chain(function(n){return e(n).run(t)})}.bind(this))},t.prototype.ap=function(e){return new t(function(t){return this.run(t).ap(e.run(t))}.bind(this))},t.prototype.map=function(e){return this.chain(function(n){return t.of(e(n))})},t.of=function(n){return new t(function(t){return e.of(n)})},t.ask=function(){return new t(e.of)},t}},538:function(e,t,n){var r=n(526);function i(e){return function(t,n){return new r(function(r,i){var o,u=2;t[e](function(e){n.run(e).fork(r,function(e){o=e,0==--u&&i(o)})},r,function(){0==--u&&i(o)})})}}e.exports={runReadTransaction:i("readTransaction"),runWriteTransaction:i("transaction")}},539:function(e,t,n){var r=n(528),i=n(527);function o(){}o.prototype.getSlice=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._getDatabase().then(this._fetchSlice(e,t,n))},o.prototype.getByGuid=function(e){return this._getDatabase().then(this._fetch(e))},o.prototype.insertOrReplace=function(e){return this._getDatabase().then(this._insertOrReplace(e))},o.prototype.cleanDatabase=function(){return this._getDatabase().then(this._cleanDatabase())},o.prototype.rebuildDatabase=function(e){var t=this;return this._getDatabase().then(function(n){return r.promiseFromTask(t._rebuildDb(e).run(n))})},o.prototype.fetchDirty=function(){var e=this;return this._getDatabase().then(function(t){return r.promiseFromTask(e._fetchDirty().run(t))})},o.prototype.makeClean=function(e){var t=this;return this._getDatabase().then(function(n){return r.promiseFromTask(t._makeClean(e).run(n))})},o.prototype.cleanupDirtyObjects=function(){return this._getDatabase().then(this._cleanupDirtyObjects())},o.prototype._getDatabase=function(){return Promise.reject(new Error("not implemented"))},o.prototype._initialize=function(){return Promise.reject(new Error("not implemented"))},o.prototype._fetch=function(e){return function(e){return Promise.reject(new Error("not implemented"))}},o.prototype._fetchSlice=function(e,t,n){return function(e){return Promise.reject(new Error("not implemented"))}},o.prototype._insertOrReplace=function(e){return function(e){return Promise.reject(new Error("not implemented"))}},o.prototype._cleanDatabase=function(){return function(e){return Promise.reject(new Error("not implemented"))}},o.prototype._rebuildDb=function(e){return i.rejected(new Error("not implemented"))},o.prototype._fetchDirty=function(){return i.rejected(new Error("not implemented"))},o.prototype._makeClean=function(){return i.rejected(new Error("not implemented"))},o.prototype._cleanupDirtyObjects=function(){return function(e){return Promise.reject(new Error("not implemented"))}},e.exports=o},556:function(e,t,n){"use strict";n.r(t),n.d(t,"FileBackend",function(){return a});var r=n(216),i=n(24),o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._storageDirPromise=null}return u(e,[{key:"readFile",value:function(e){return this._openFile(e).then(function(e){return function(e){return Object(r.callbackToPromise)(e.file.bind(e)).then(m).then(function(e){return new Blob([e])})}(e)})}},{key:"storeFile",value:function(e,t){return this._openFile(t,!0).then(function(t){return n=t,i=e,Object(r.callbackToPromise)(n.createWriter.bind(n)).then(function(e){return function(e,t){return new Promise(function(n,r){t.onwrite=n,t.onerror=r,t.write(e)})}(i,e)});var n,i})}},{key:"moveFile",value:function(e,t){var n,r,i,u,a,s;return regeneratorRuntime.async(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,regeneratorRuntime.awrap(this._openFile(e));case 2:return n=l.sent,r=c(t),i=o(r,2),u=i[0],a=i[1],l.next=6,regeneratorRuntime.awrap(this._openDir(u));case 6:return s=l.sent,l.next=9,regeneratorRuntime.awrap(p(n,s,a));case 9:case"end":return l.stop()}},null,this)}},{key:"downloadFile",value:function(e,t){var n=this;return this._config.downloadFileFn?Object(r.callbackToPromise)(this._config.downloadFileFn,e,t):Object(i.get)(e,"blob").then(function(e){return n.storeFile(e,t)})}},{key:"removeDir",value:function(e){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this._openDir(e));case 3:return t=n.sent,n.next=6,regeneratorRuntime.awrap(f(t));case 6:n.next=12;break;case 8:if(n.prev=8,n.t0=n.catch(0),1===n.t0.code){n.next=12;break}throw n.t0;case 12:case"end":return n.stop()}},null,this,[[0,8]])}},{key:"_openFile",value:function(e){var t,n,r,i,u,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return t=c(e),n=o(t,2),r=n[0],i=n[1],s.next=3,regeneratorRuntime.awrap(this._openDir(r,a));case 3:return u=s.sent,s.abrupt("return",l(u,i,a));case 5:case"end":return s.stop()}},null,this)}},{key:"_openDir",value:function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.split("/").filter(function(e){return""!==e}),o.next=3,regeneratorRuntime.awrap(this._getStorageDir());case 3:n=o.sent,r=0;case 5:if(!(r<t.length)){o.next=12;break}return o.next=8,regeneratorRuntime.awrap(s(n,t[r],i));case 8:n=o.sent;case 9:++r,o.next=5;break;case 12:return o.abrupt("return",n);case 13:case"end":return o.stop()}},null,this)}},{key:"_getStorageDir",value:function(){return this._config.getStorageDirFn?Object(r.callbackToPromise)(this._config.getStorageDirFn):(null===this._storageDirPromise&&(this._storageDirPromise=Object(r.callbackToPromise)(window.webkitRequestFileSystem,window.TEMPORARY,1048576).then(function(e){return e.root})),this._storageDirPromise)}}]),e}();function c(e){return e.split(/\/([^\/]+)$/)}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(r.callbackToPromise)(e.getDirectory.bind(e),t,{create:n})}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(r.callbackToPromise)(e.getFile.bind(e),t,{create:n})}function f(e){return Object(r.callbackToPromise)(e.removeRecursively.bind(e))}function m(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=function(e){return n(e.target.error)},r.readAsArrayBuffer(e)})}function p(e,t,n){return new Promise(function(r,i){e.moveTo(t,n,r,i)})}},558:function(e,t,n){"use strict";n.r(t);var r=n(532),i=n(11);function o(e){return e.replace(/:/g,"_")}var u="GUID:",a=new RegExp("^"+u);function c(e){return!a.test(e)}function s(e){return"guid"===e||"$"===e[0]}function l(e,t){return e.$readonlyAttrs.includes(t)}function f(e){var t=Object.keys(e).filter(function(e){return!s(e)}).reduce(function(t,n){return t[n]={value:e[n]},l(e,n)&&(t[n].readonly=!0),t},{});return{guid:e.guid,objectType:e.$objectType,attributes:t}}function m(e){var t={guid:e.guid,$objectType:e.objectType,$readonlyAttrs:[]};for(var n in e.attributes)t[n]=e.attributes[n].value,e.attributes[n].readonly&&t.$readonlyAttrs.push(n);return t}var p=n(84),h=n(23),d=n(293),y=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),b=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function g(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var v=n(11),w={String:null,Integer:"0",Long:"0",Decimal:"0",Float:"0",Currency:"0",Enum:null,HashString:null,ObjectReference:null,DateTime:null,Boolean:!1,AutoNumber:"0",Binary:null},_=function(e){function t(e,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=e||{},u._store=r,u._getDocumentUrl=e.getDocumentUrlFn||x,u._objectCache=n,u._fileBackend=i,u._synchronizer=o,u._dirtyGuids=[],u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d["a"]),b(t,[{key:"initialize",value:function(){var e;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._store.fetchDirty());case 2:e=t.sent,this._dirtyGuids=e.map(function(e){return e.guid});case 4:case"end":return t.stop()}},null,this)}},{key:"getByGuid",value:function(e,t){return Promise.all(e.map(this._getByGuid,this)).then(function(e){return{mxobjects:e.filter(function(e){return null!=e}).map(f)}})}},{key:"getByPath",value:function(e,t,n,r){var i,o,u,a,c,s,l,f,m,p,d,b,g,v,w=this;return regeneratorRuntime.async(function(_){for(;;)switch(_.prev=_.next){case 0:if("reverse"!==r){_.next=11;break}return i=this._objectCache.getAllObjects().filter(function(n){return n.getReferences(t).includes(e)}).map(function(e){return e.jsonData}),_.next=4,regeneratorRuntime.awrap(this.getSlice(n,[{attribute:t,operator:"equals",value:e}]));case 4:return o=_.sent,u=o.mxobjects,a=u.map(function(e){return h.MxObject.fromJson(e)}).filter(function(n){return n.getReferences(t).includes(e)}),c=a.filter(function(e){return!i.some(function(t){return t.guid===e.getGuid()})}).map(function(e){return e.jsonData}),_.abrupt("return",{mxobjects:i.concat(c)});case 11:if(s=this._objectCache.getObject(e)){_.next=19;break}return _.next=15,regeneratorRuntime.awrap(this.getByGuid([e]));case 15:l=_.sent,f=y(l.mxobjects,1),(m=f[0])&&(s=h.MxObject.fromJson(m));case 19:if(s){_.next=21;break}return _.abrupt("return",{mxobjects:[]});case 21:return p=s.getReferences(t),d=p.map(function(e){return w._objectCache.getObject(e)}).filter(function(e){return null!==e}).map(function(e){return e.jsonData}),b=p.filter(function(e){return!w._objectCache.has(e)}),_.next=26,regeneratorRuntime.awrap(this.getByGuid(b));case 26:return g=_.sent,v=g.mxobjects,_.abrupt("return",{mxobjects:v.concat(d)});case 29:case"end":return _.stop()}},null,this)}},{key:"getSlice",value:function(e,t,n){var r=this,i=window.mx.meta.getEntity(e),o=(t||[]).map(function(e){return e.attribute&&i.isReference(e.attribute)&&(e.value=r._synchronizer.getInternalGuid(e.value)),e});return this._store.getSlice(e,o,n).then(function(e){var t=y(e,2),n=t[0],i=t[1];return{mxobjects:n.map(r._synchronizer.makeObjectExternal,r._synchronizer).map(f),count:i}})}},{key:"create",value:function(e){var t=u+i.getUniqueId();return this._objectCache.onCreate([t]),this._objectCache.setMxObjects([function(e,t){var n={guid:e,objectType:t,attributes:{}},r=window.mx.meta.getEntity(t);return r.getAttributes().forEach(function(e){n.attributes[e]={value:w[r.getAttributeType(e)]}}),n}(t,e)]),Promise.resolve({actionResult:t})}},{key:"commit",value:function(e,t){var n,r,i,o,u,a,c,s,l,m,p,h=this;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return p=function(e){var t={};return Object.keys(e).forEach(function(n){t[n]=Object.keys(e[n])}),t},m=function(e){return Object.assign({},e,v.mapObject(r[e.guid],function(e){return e.value}))},r=v.objectFromArray(e.map(function(e){return[e,v.clone(h._objectCache.getChanges(e))]})),i=v.partition(function(e){return h._objectCache.has(e)},e),o=y(i,2),u=o[0],a=o[1],c=u.map(function(e){return h._objectCache.getObject(e)}).map(j),t.next=7,regeneratorRuntime.awrap(Promise.all(a.map(this._getByGuid,this)));case 7:return s=t.sent,l=s.concat(c).map(m),t.next=11,regeneratorRuntime.awrap(this._store.insertOrReplace(l.map(this._synchronizer.makeObjectInternal,this._synchronizer)));case 11:return(n=this._dirtyGuids).push.apply(n,g(e)),this._objectCache.onCommit(e),this._objectCache.setMxObjects(l.map(function(e){return f(Object.assign(e,{$dirty:!0}))})),this._objectCache.removeChanges(p(r)),t.abrupt("return",{});case 16:case"end":return t.stop()}},null,this)}},{key:"rollback",value:function(e){var t=this;this._objectCache.removeAllChanges(e);var n=e.filter(function(e){return t._objectCache.isNew(e)});return this._objectCache.removeObjects(n),Promise.resolve({})}},{key:"validate",value:function(e){return Promise.resolve({})}},{key:"saveDocument",value:function(e,t,n,r){var i=this;if(r.size/1048576>n.maxFileSize)return Promise.reject(new p.DescribedError("File too large"));var u=o(this._synchronizer.getInternalGuid(e));return this._fileBackend.storeFile(r,"files/documents/"+u).then(function(){return i._objectCache.makeChange(e,"HasContents",!0),i.commit([e],null)})}},{key:"getDocumentUrl",value:function(e,t,n){return this._getDocumentUrl(o(this._synchronizer.getInternalGuid(e)),t,n)}},{key:"getImageUrl",value:function(e){return Promise.resolve(e)}},{key:"upload",value:function(){return this._synchronizer.upload()}},{key:"downloadObjects",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._synchronizer.downloadObjects(e));case 2:this._dirtyGuids=[];case 3:case"end":return t.stop()}},null,this)}},{key:"downloadFiles",value:function(e){return this._synchronizer.downloadFiles(e)}},{key:"cleanupDirtyObjects",value:function(){return this._store.cleanupDirtyObjects()}},{key:"isDirty",value:function(e){return this._dirtyGuids.includes(e)}},{key:"cleanup",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._store.cleanDatabase());case 2:return e.next=4,regeneratorRuntime.awrap(this._fileBackend.removeDir("files/documents/"));case 4:return e.next=6,regeneratorRuntime.awrap(this._fileBackend.removeDir("files/thumbnails/"));case 6:this._dirtyGuids=[];case 7:case"end":return e.stop()}},null,this)}},{key:"_getByGuid",value:function(e){var t=this;return this._store.getByGuid(this._synchronizer.getInternalGuid(e)).then(function(e){return t._synchronizer.makeObjectExternal(e)})}}]),t}();function j(e){return m(e.jsonData)}function x(e,t,n){var r=n?"thumbnails":"documents";return"filesystem:"+window.mx.appUrl+"temporary/files/"+r+"/"+e+"?"+ +new Date}var T=n(21),E=n(69),k=n(281),O=n(215),R=n(306),D=n(45),S=n(11),C=n.n(S),F=n(33),A=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),N=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var P=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._store=t,this._fileBackend=n,this._objectCache=r,this._internalToExternal={}}return N(e,[{key:"upload",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(this._upload());case 3:e.next=16;break;case 5:if(e.prev=5,e.t0=e.catch(0),!(e.t0 instanceof E.ConnectionError)){e.next=11;break}throw new R.TemporarySynchronizationError;case 11:if(e.t0 instanceof k.a){e.next=15;break}throw new O.SynchronizationError;case 15:throw e.t0;case 16:case"end":return e.stop()}},null,this,[[0,5]])}},{key:"downloadObjects",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(this._downloadObjects(e));case 3:t.next=12;break;case 5:if(t.prev=5,t.t0=t.catch(0),!(t.t0 instanceof E.ConnectionError)){t.next=11;break}throw new R.TemporarySynchronizationError;case 11:throw new O.SynchronizationError;case 12:case"end":return t.stop()}},null,this,[[0,5]])}},{key:"downloadFiles",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(this._downloadFiles(e));case 3:t.next=12;break;case 5:if(t.prev=5,t.t0=t.catch(0),!(t.t0 instanceof E.ConnectionError)){t.next=11;break}throw new R.TemporarySynchronizationError;case 11:throw new O.SynchronizationError;case 12:case"end":return t.stop()}},null,this,[[0,5]])}},{key:"_upload",value:function(){var e,t,n,r,i,u,a,f,m,p,h,d,y,b,g,v,w,_,j,x,E,O,R,D=this;return regeneratorRuntime.async(function(S){for(;;)switch(S.prev=S.next){case 0:return R=function(e,t){var n=window.mx.meta.getEntity(e.$objectType),r=Object.keys(e).filter(function(t){return!s(t)&&n.isSyncable(t)&&!l(e,t)}).map(function(r){var i=e[r];return[r,{value:n.isObjectReference(r)&&null!=i&&!c(i)?t[i]:i}]});return[c(e.guid)?e.guid:t[e.guid],C.a.objectFromArray(r)]},O=function(e){return Object(T.h)(e.$objectType).then(function(t){var n=t.objects.find(function(e){return e.guid===t.actionResult});return{internalObj:e,remoteJson:n}})},E=function(t){var n,r,i;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return n="files/documents/"+o(t.guid),u.next=3,regeneratorRuntime.awrap(e.readFile(n));case 3:return r=u.sent,u.next=6,regeneratorRuntime.awrap(Object(F.uploadWithRetries)("__sync__","",r,2));case 6:return i=u.sent,u.abrupt("return",{tempGuid:i.commits[0],fileObjGuid:t.guid});case 8:case"end":return u.stop()}},null,this)},x=function(e){return window.mx.meta.getEntity(e.$objectType).isA("System.FileDocument")&&e.HasContents},j=function(e){var t=window.mx.meta.getEntity(e.$objectType);return C.a.arrayFromObject(e).filter(function(e){var n=A(e,2),r=n[0];n[1];return"guid"===r||!s(r)&&t.isReference(r)})},_=function(e){var t=e.map(function(e){return e.guid}),n=C.a.unique(e.map(function(e){return j(e).map(function(e){var t=A(e,2);t[0];return t[1]})}).reduce(function(e,t){return e.concat(t)},[])).filter(function(e){return!c(e)}).filter(function(e){return!t.includes(e)});if(n.length>0){var r="Sync has failed due to a modeling error. Your database contains objects that reference uncommitted objects:\n"+C.a.unique(e.map(function(e){return j(e).filter(function(e){var t=A(e,2),r=(t[0],t[1]);return n.includes(r)}).map(function(t){var n=A(t,2),r=n[0];n[1];return"object of type "+e.$objectType+" (reference "+r+")"})}).reduce(function(e,t){return e.concat(t)},[])).join(", ")+".";throw new k.a(r)}},e=this._fileBackend,S.next=9,regeneratorRuntime.awrap(this._store.fetchDirty());case 9:if(0!==(t=S.sent).length){S.next=12;break}return S.abrupt("return",{});case 12:return _(t),n=C.a.partition(function(e){return c(e.guid)},t),r=A(n,2),i=r[0],u=r[1],a=u.filter(x),f=i.filter(x),S.next=18,regeneratorRuntime.awrap(Promise.all([Promise.all(a.concat(f).map(E)),Promise.all(u.map(O))]));case 18:return m=S.sent,p=A(m,2),h=p[0],d=p[1],y=C.a.objectFromArray(d.map(function(e){var t=e.internalObj,n=e.remoteJson;return[t.guid,n.guid]})),b=C.a.objectFromArray(h.map(function(e){var t=e.tempGuid,n=e.fileObjGuid;return c(n)?[t,n]:[t,y[n]]})),g=i.map(function(e){return e.guid}).concat(d.map(function(e){return e.remoteJson.guid})),v=d.map(function(e){return e.remoteJson}),w=C.a.objectFromArray(t.map(function(e){return R(e,y)})),S.next=29,regeneratorRuntime.awrap(Object(T.w)(g,b,w,v));case 29:return S.next=31,regeneratorRuntime.awrap(this._store.makeClean(t));case 31:return S.next=33,regeneratorRuntime.awrap(Promise.all(a.map(function(t){var n,r;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return n="files/documents/"+o(t.guid),r="files/documents/"+o(y[t.guid]),i.next=4,regeneratorRuntime.awrap(e.moveFile(n,r));case 4:case"end":return i.stop()}},null,D)})));case 33:return C.a.arrayFromObject(y).forEach(function(e){var t=A(e,2),n=t[0],r=t[1];return D._mapInternalGuid(n,r)}),S.abrupt("return",{});case 35:case"end":return S.stop()}},null,this)}},{key:"_downloadObjects",value:function(e){var t,n,r,i,o,u,a,c,s,l;return regeneratorRuntime.async(function(p){for(;;)switch(p.prev=p.next){case 0:return l=function(e,t){return Object(T.u)(t).then(function(t){return t.mxobjects.map(m).map(function(t){return Object.assign({},t,{$objectType:e})})})},p.t0=C.a,p.next=4,regeneratorRuntime.awrap(Promise.all(e.map(function(e){var t=e.store,n=e.xpath;return l(t,n)})));case 4:return p.t1=p.sent,t=p.t0.flatten.call(p.t0,p.t1),p.next=8,regeneratorRuntime.awrap(this._store.rebuildDatabase(t));case 8:return n=t.map(this.makeObjectExternal,this),r=this._objectCache.getAllObjects().map(function(e){return[n.find(function(t){return t.guid===e.getGuid()}),e]}),i=C.a.partition(function(e){return void 0!==A(e,1)[0]},r),o=A(i,2),u=o[0],a=o[1],this._objectCache.setMxObjects(u.map(function(e){return f(A(e,1)[0])})),this._objectCache.onDelete(a.map(function(e){var t=A(e,2);t[0];return t[1].getGuid()})),c=e.map(function(e){return e.store}).map(function(e){return window.mx.data.update2({entity:e})}),s=u.map(function(e){return A(e,1)[0].guid}).concat(a.map(function(e){var t=A(e,2);t[0];return t[1].getGuid()})).map(function(e){return window.mx.data.update2({guid:e})}),p.next=17,regeneratorRuntime.awrap(Promise.all(s.concat(c)));case 17:return p.abrupt("return",{});case 18:case"end":return p.stop()}},null,this)}},{key:"_downloadFiles",value:function(e){var t,n,r,i,u,a,c;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return c=function(e,t){var r=Object(D.getRemoteDynamicResourceUrl)(e.guid,e.changedDate,t),i=(t?"files/thumbnails/":"files/documents/")+o(e.guid);return n.downloadFile(r,i)},a=function(e){return t.getSlice(e,[{attribute:"HasContents",operator:"equals",value:"true"}]).then(function(e){var t=A(e,2),n=t[0];t[1];return n})},t=this._store,n=this._fileBackend,s.t0=C.a,s.next=7,regeneratorRuntime.awrap(Promise.all(e.map(function(e){return a(e)})));case 7:return s.t1=s.sent,r=s.t0.flatten.call(s.t0,s.t1),i=r.map(function(e){return c(e,!1)}),u=r.filter(function(e){return window.mx.meta.getEntity(e.$objectType).isA("System.Image")}).map(function(e){return c(e,!0)}),s.next=13,regeneratorRuntime.awrap(Promise.all(i.concat(u)));case 13:return s.abrupt("return",{});case 14:case"end":return s.stop()}},null,this)}},{key:"getExternalGuid",value:function(e){return this._internalToExternal[e]||e}},{key:"getInternalGuid",value:function(e){for(var t in this._internalToExternal)if(this._internalToExternal[t]===e)return t;return e}},{key:"makeObjectExternal",value:function(e){return B(e,this.getExternalGuid.bind(this))}},{key:"makeObjectInternal",value:function(e){return B(e,this.getInternalGuid.bind(this))}},{key:"_mapInternalGuid",value:function(e,t){this._internalToExternal[t]=e}}]),e}();function B(e,t){if(null===e)return null;var n=window.mx.meta.getEntity(e.$objectType);return C.a.mapObject(e,function(e,r){return("guid"===r||!s(r)&&n.isReference(r))&&null!=e?t(e):e})}function I(e,t,n){var i,o,u,a,c=n.createStoreFn,s=n.getStorageDirFn,l=n.downloadFileFn,f=n.getDocumentUrlFn;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return i=new r(window.mx.session.getConfig("sync_config.schema"),c),o=new t({downloadFileFn:l,getStorageDirFn:s}),u=new P(i,o,e),a=new _({getDocumentUrlFn:f},e,i,o,u),n.next=6,regeneratorRuntime.awrap(a.initialize());case 6:return n.abrupt("return",a);case 7:case"end":return n.stop()}},null,this)}n.d(t,"buildOfflineDataBackend",function(){return I})}}]);